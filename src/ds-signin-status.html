<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/google-signin-aware.html">
<link rel="import" href="../bower_components/google-apis/google-client-api.html">

<dom-module id="ds-user-badge">

  <template>

    <style>
      :host {
        display: inline-block;
      }
      div {
        padding: 5px 10px;
        border: 1px solid #999;
      }
      img {
        vertical-align: botton;
        max-width: 30px;
        max-height: 30px;
      }
    </style>

    <google-api-loader
      id="plus" 
      name="plus" 
      version="v1" 
      on-google-api-load="{{_displayProfile}}"></google-signin-aware>

    <div>
      <template if="{{signedIn}}">


    <google-signin-aware
      scopes="email profile"
      signed-in="{{signedIn}}"
      offline="{{offline}}"
      is-authorized="{{authorized}}"
      need-additional-auth="{{additionalAuthNeeded}}"
      on-google-signin-aware-error="_handleSignInError"
      on-google-signin-aware-success="_handleSignIn"
      on-google-signin-offline-success="_handleOffline"
      on-google-signin-aware-signed-out="_handleSignOut"></google-signin-aware>

  </template>

  <script>

    Polymer({

      is: 'ds-user-badge',

      properties: {
        userName: String,
        status: String
      },
      _handleSignInError = function(event) {
        this.status = JSON.stringify(event.detail);
      },
      _handleSignIn: function(response) {
        this.status = 'Signin granted';
        this.userName = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName();
      },
      _handleOffline: function(response) {
        this.offlineCode = response.detail.code;
      },
      _handleSignOut: function(response) {
        this.status = 'Signed out';
        this.username = 'N/A';
      }
    });

  </script>

</dom-module>
